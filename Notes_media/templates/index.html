{% extends "layout.html" %}
{% block body %}
    {% if user.is_authenticated %}
        <form action="{% url 'index' %}" method="post" enctype="multipart/form-data" autocomplete="off">
            {% csrf_token %}
            <label for="title">Title</label>
            <input type="text" name="title" required>
            <br>
            <label for="body">Body</label>
            <textarea name="description" id="" cols="30" rows="10" required></textarea>
            <br>
            <label for="image">Images</label>
            <input type="file" name="image" accept="image/*" multiple>
            <br>
            <label for="pdf_file">Pdf file</label>
            <input type="file" name="pdf_file" accept=".pdf">
            <br>
            <input type="submit">
        </form>
        {% if messages %}
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        {% endif %}
    {% endif %}
    <div>
        {% for post in posts %}
            <div id={{post.id}} class="p-2 bg-blue-200 width-screen mr-8 rounded-lg" data-csrf="{{csrf_token}}">
                <div class="flex p-2 items-align text-lg">
                    <a href="{% url 'post' post.id%}" class="mr-4">
                        <img
                            src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png"
                            class="w-14 h-14 rounded-full"
                            alt="Profile"
                        />
                    </a>
                    {{post.user.username}}
                </div>
                <div>Category - {{post.category.category}}</div>
                <div>Level - {{post.level.level}}</div>
                <div class="text-4xl ml-2 mb-2">
                    {{post.title}}
                </div>
                <div class="whitespace-normal break-all ml-2 mb-2">
                    {{post.description}}
                </div>
                {% if post.image %}
                    <div class="flex gap-3">
                        {% for image in post.image.all %}
                            <img src="{{image.image.url}}" width="200px">
                        {% endfor %}
                    </div>
                {% endif %}
                {% if post.file %}
                    <div><a href="{{post.file.url}}" download="">download</a></div>
                {% endif %}
                <div class="select-none">
                    {% if user.is_authenticated %}
                        {% if user in post.like.all %}
                            <i class="fa-solid fa-thumbs-up cursor-pointer like-unlike" id="unlike"></i>
                        {% else %}
                            <i class="fa-regular fa-thumbs-up cursor-pointer like-unlike" id="like"></i>
                        {% endif %}
                    {% else %}
                        <i class="fa-regular fa-thumbs-up"></i>
                    {% endif %}
                    <span id="like-count">{{post.like.count}}</span>
                </div>
                {% if user == post.user %}
                    <button id="delete_post">Delete</button>
                {% endif %}
            </div>
            <br>
            <br>
        {% endfor %}
    </div>
    {% load static %}
    <script src="{% static 'js/post.js' %}"></script>
{% endblock %}