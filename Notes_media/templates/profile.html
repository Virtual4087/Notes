{% extends "layout.html" %}
{% block body %}

    {% if not profile %}
        <div>
            <img src="https://lh6.googleusercontent.com/Bu-pRqU_tWZV7O3rJ5nV1P6NjqFnnAs8kVLC5VGz_Kf7ws0nDUXoGTc7pP87tyUCfu8VyXi0YviIm7CxAISDr2lJSwWwXQxxz98qxVfMcKTJfLPqbcfhn-QEeOowjrlwX1LYDFJN">
        </div>
    {% else %}
        <div class="h-full bg-gray-200 p-8">
            <div class="bg-white rounded-lg shadow-xl pb-8">
                <div class="w-full h-[250px]">
                    <img src="https://vojislavd.com/ta-template-demo/assets/img/profile-background.jpg" class="w-full h-full rounded-tl-lg rounded-tr-lg">
                </div>
                <div class="flex flex-col items-center -mt-20">
                    <img src="https://vojislavd.com/ta-template-demo/assets/img/profile.jpg" class="w-40 border-4 border-white rounded-full">
                    <div class="flex items-center mt-2">
                        <p class="text-4xl">{{ user.username }}</p>
                    </div>
                    <p class="text-gray-700 ">Occupation</p>
                </div>
                {% if user.is_authenticated and user != profile %}
                    <div class="flex-1 flex flex-col items-center lg:items-end justify-end px-8 mt-2">
                        <div class="flex items-center space-x-4 mt-2">
                            {% if not user in profile.follower.all %}
                                <button type="button" class="btn rounded-full p-1 px-4 font-semibold cursor-pointer ml-2 bg-green-500 text-white hover:bg-green-900 hover:text-green-300 follow_unfollow" id="follow" data-csrf="{{csrf_token}}">Follow</button type="button">
                            {% else %}
                                <button type="button" class="btn rounded-full p-1 px-4 font-semibold cursor-pointer ml-2 bg-green-500 text-white hover:bg-green-900 hover:text-green-300 follow_unfollow" id="unfollow" data-csrf="{{csrf_token}}">Unfollow</button type="button">
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
    
            <div class="my-4 flex flex-col 2xl:flex-row space-y-4 2xl:space-y-0 2xl:space-x-4">
                <div class="w-full flex flex-col 2xl:w-1/3">
                    <div class="flex-1 bg-white rounded-lg shadow-xl p-8">
                        <h4 class="text-xl text-gray-900 font-bold">Personal Info</h4>
                        <ul class="mt-2 text-gray-700">
                            <li class="flex border-y py-2">
                                <span class="font-bold w-24">Full name:</span>
                                <span class="text-gray-700">___</span>
                            </li>
                            <li class="flex border-b py-2">
                                <span class="font-bold w-24">Education:</span>
                                <span class="text-gray-700">___</span>
                            </li>
                            <li class="flex border-b py-2">
                                <span class="font-bold w-24">Birthday:</span>
                                <span class="text-gray-700">___</span>
                            </li>
                            <li class="flex border-b py-2">
                                <span class="font-bold w-24">Email:</span>
                                <span class="text-gray-700">___</span>
                            </li>
                            <li class="flex border-b py-2">
                                <span class="font-bold w-24">Location:</span>
                                <span class="text-gray-700">___</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="flex flex-col w-full 2xl:w-2/3">
                    <div class="flex-1 bg-white rounded-lg shadow-xl p-8">
                        <h4 class="text-xl text-gray-900 font-bold">About</h4>
                        <p class="mt-2 text-gray-700">Lorem ipsum dolor sit amet consectetur adipisicing elit. Nesciunt voluptates obcaecati numquam error et ut fugiat asperiores. Sunt nulla ad incidunt laboriosam, laudantium est unde natus cum numquam, neque facere. Lorem ipsum dolor sit amet consectetur adipisicing elit. Ut, magni odio magnam commodi sunt ipsum eum! Voluptas eveniet aperiam at maxime, iste id dicta autem odio laudantium eligendi commodi distinctio!</p>
                    </div>
                    <div class="flex-1 bg-white rounded-lg shadow-xl mt-4 p-8">
                        <h4 class="text-xl text-gray-900 font-bold mb-4">Posts</h4>  
                        {% for post in profile.user_posts.all %}
                            <div id={{post.id}} class="p-4 px-6 bg-blue-200 width-screen rounded-lg" data-csrf="{{csrf_token}}">
                                <div class="flex flex-row items-align text-lg">
                                    <a href="{% url 'profile' post.user.username%}" class="mr-4">
                                        <img
                                            src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png"
                                            class="w-14 h-14 rounded-full"
                                            alt="Profile"
                                        />
                                    </a>
                                    <div class="mt-2">
                                        {{post.user.username}}
                                    </div>
                                    
                                </div>
                                <a href="{% url 'post' post.id%}">
                                    <div class="text-4xl flex flex-col mt-2">
                                        <div class="">
                                            {{post.title}}
                                        </div>
                                        <div class="flex mt-3">
                                            <a href="{% url 'index' %}" class="mr-1 bg-opacity-50 mt-1 group flex items-center w-max text-sm px-4 py-1 mb-3 text-base bg-white leading-6 font-medium rounded-2xl hover:bg-blue-900 hover:text-blue-300">
                                                Category{{post.category.category}}
                                            </a>
                                            <a href="{% url 'index' %}" class="bg-opacity-50 mt-1 group flex items-center w-max px-4 text-sm py-1 mb-3 text-base bg-white leading-6 font-medium rounded-full hover:bg-blue-900 hover:text-blue-300">
                                                Level{{post.level.level}}
                                            </a>
                                        </div> 
                                    </div>
                                    <div class="whitespace-normal break-all mb-2">
                                        {{post.description}}
                                    </div>
                                </a>
                                {% if post.image %}
                                    <div class="flex gap-3 mb-2">
                                        {% for image in post.image.all %}
                                            <img src="{{image.image.url}}" width="200px">
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {% if post.file %}
                                    <div><a href="{{post.file.url}}" download="">download</a></div>
                                {% endif %}
                                <div class="select-none mx-1 flex-row">
                                    {% if user.is_authenticated %}
                                        {% if user in post.like.all %}
                                            <i class="fa-solid fa-thumbs-up cursor-pointer like-unlike" id="unlike"></i>
                                        {% else %}
                                            <i class="fa-regular fa-thumbs-up cursor-pointer like-unlike" id="like"></i>
                                        {% endif %}
                                    {% else %}
                                        <i class="fa-regular fa-thumbs-up"></i>
                                    {% endif %}
                                    <span id="like-count">{{post.like.count}}</span>
                                </div>
                                {% if user == post.user %}
                                    <button id="delete_post">Delete</button>
                                {% endif %}
                                <div class="mx-1">
                                    Comments
                                </div>
                            </div>
                            <br>
                        {% endfor %}
                    </div>
    
                        <div class="mt-4">
                            <canvas id="verticalBarChart" style="display: block; box-sizing: border-box; height: 414px; width: 828px;" width="1656" height="828"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>    
    {% endif %}

    {% if user.is_authenticated and user != profile %}
        <script>
            document.querySelector(".follow_unfollow").onclick = (event) => {
                button = event.target
                fetch("", {
                    method : "POST",
                    headers : {
                        "Source" : "follow_unfollow",
                        "Content-Type" : "application/json",
                        "X-CSRFToken" : button.dataset.csrf
                    },
                    body : JSON.stringify({
                        perform : button.id
                    })
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data)
                    if (data["success"] == true){
                        console.log(button)
                        if (button.id == "follow"){
                            button.id = "unfollow"
                            button.innerText = "unfollow"
                        }else{
                            button.id = "follow"
                            button.innerText = "follow"
                        }
                    }
                })
            }
        </script>
    {% endif %}


{% endblock %}